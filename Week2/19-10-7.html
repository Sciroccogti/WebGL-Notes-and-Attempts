<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>页面标题</title>
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 vPosition;
        
        void main()
        {
            gl_Position = vPosition;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        
        void main()
        {
            gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
        }
    </script>
    <script type="text/javascript" src="../Common/webgl-utils.js"></script>
    <script type="text/javascript" src="../Common/initShaders.js"></script>
    <script type="text/javascript" src="../Common/MV.js"></script>
    <script>
        var gl;
        var points;
        var centre = vec2(0, 0);
        var interval;
        var time = 0;
        var ground;

        window.onload = function init() {
            var canvas = document.getElementById("gl-canvas");

            gl = WebGLUtils.setupWebGL(canvas);
            if (!gl) { alert("WebGL isn't available"); }

            //
            //  Configure WebGL
            //
            //    gl.viewport( 0, 0, canvas.width, canvas.height );
            gl.viewport(0, 0, 256, 256);
            gl.clearColor(0.0, 0.0, 0.0, 1.0);

            //  Load shaders and initialize attribute buffers

            var program = initShaders(gl, "vertex-shader", "fragment-shader");
            gl.useProgram(program);

            // Load the data into the GPU

            var bufferId = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, bufferId);

            // Associate out shader variables with our data buffer
            gl.vertexAttribPointer(vPosition, 2, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(vPosition);

            var vPosition = gl.getAttribLocation(program, "vPosition");

            render();
        };


        function render() {
            // Four Vertices

            var vertices = [
                add(centre, vec2(-0.5, -0.5)),
                add(centre, vec2(-0.5, 0.5)),
                add(centre, vec2(0.5, 0.5)),
                add(centre, vec2(0.5, -0.5))
            ];

            gl.bufferData(gl.ARRAY_BUFFER, flatten(vertices), gl.STATIC_DRAW);


            gl.clear(gl.COLOR_BUFFER_BIT);
            gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);
        }

        // canvas.addEventListener("click", function () {
        //     gl.bindBuffer(gl.ARRAY_BUFFER, vBuffer);
        //     var t = vec2(-1 + 2 * event.clientX / canvas.width,
        //                 -1 + 2 * (canvas.height - event.clientY) / canvas.height);
        //     gl.bufferSubData(gl.ARRAY_BUFFER, sizeof['vec2'] * index, t);
        //     index++;
        // });
        window.addEventListener("keydown", function () {
            switch (event.keyCode) {
                case 37: // Left
                    centre = add(centre, vec2(-0.01, 0));
                    break;
                case 38: // Up
                    centre = add(centre, vec2(0, 0.01));
                    break;
                case 39: // Right
                    centre = add(centre, vec2(0.01, 0));
                    break;
                case 40: // Down
                    centre = add(centre, vec2(0, -0.01));
                    break;
                case 32: // Spacebar
                    ground = centre;
                    interval = setTimeout(jump(ground), 10); // 10ms
                default:
                    break;
            }
            render();
        });

        function jump() {
            time += 10;
            // x = 1/2 * a * t^2, vmax = (2 * a * x)^(0.5);
            var height = 0.02 * time - 0.5 * time * time * 0.0004;
            centre = add(ground, vec2(0, height));
            render();
            if (time >= 100) {
                clearTimeout(interval);
                time = 0;
            } else {
                requestAnimationFrame(jump);
            }
        }
    </script>

</head>
<!-- 发挥想象力，绘制一只动物（2D），要求：
A、	窗口背景白色，动物至少有两种颜色；
B、	可利用鼠标选取动物全部或某一部分，并拖动
C、	利用键盘实现前进、后退、跳跃等功能
D、	实现菜单功能
 -->

<body>
    <canvas id="gl-canvas" width="512" height="256">
</body>



</html>